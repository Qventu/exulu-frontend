exports.id=2711,exports.ids=[2711],exports.modules={40738:(e,s,t)=>{Promise.resolve().then(t.bind(t,92214))},92214:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>F});var a=t(10326),l=t(90434),n=t(88307),r=t(11890),i=t(33734),d=t(18019),o=t(90772),c=t(54432),x=t(39167),h=t(18753),u=t(42270),m=t(17577),g=t(29718),f=t(35047),p=t(65304),j=t(30510),v=t(15211),N=t(76812),w=t(32663),b=t(83855),y=t(60097),k=t(62288),S=t(34789),C=t(77863),z=t(13854),_=t(43641);function P({agent:e,type:s}){let t=(0,f.usePathname)(),{toast:r}=(0,S.pm)(),{user:i}=(0,m.useContext)(v.S),[d,g]=(0,m.useState)("");(0,z.d)();let j=(0,f.useRouter)(),[P,O]=(0,m.useState)({searchString:null}),[F,D]=(0,m.useState)(!1),[$,I]=(0,m.useState)(null),[Z,A]=(0,m.useState)(""),B=(0,x.aM)(u.GJ,{returnPartialData:!0,fetchPolicy:"network-only",nextFetchPolicy:"network-only",variables:{page:1,limit:40,filters:{agent:{eq:e}}}}),[R,G]=(0,h.D)(u.S9,{refetchQueries:[u.GJ,"GetAgentSessions"]}),[L,W]=(0,h.D)(u.fB),[E,K]=(0,h.D)(u.bI,{refetchQueries:[u.GJ,"GetAgentSessions"]}),U=async()=>{let s=await L({variables:{user:i.id,agent:e,type:"FLOW",title:d.trim(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}});if(s.errors){console.error("error",s.errors);return}if(!s.data?.agent_sessionsCreateOne?.item?.id){console.error("error","failed to create session");return}g(""),B.refetch(),j.push(`/chat/${e}/${s.data?.agent_sessionsCreateOne?.item?.id}`)},J=async()=>{if(!$||!Z.trim())return;let e=await E({variables:{id:$,title:Z.trim()}});if(e.errors){console.error("error",e.errors),r({title:"Error",description:"Failed to rename session.",variant:"destructive"});return}r({title:"Session renamed",description:"The session has been renamed successfully."}),D(!1),I(null),A("")};return(0,a.jsxs)("div",{className:"relative hidden flex-col items-start md:flex h-100 overflow-y-scroll border-r","x-chunk":"dashboard-03-chunk-0",children:[a.jsx("h2",{className:"mb-2 px-4 text-lg font-semibold tracking-tight",children:"Sessions"}),a.jsx("div",{className:"bg-background/95 w-full backdrop-blur supports-[backdrop-filter]:bg-background/60",children:a.jsx("form",{children:(0,a.jsxs)("div",{className:"relative",children:[a.jsx(n.Z,{className:"absolute left-2 top-2.5 size-4 text-muted-foreground"}),a.jsx(c.I,{onKeyUp:e=>{O(e.currentTarget.value)},placeholder:"Search sessions",className:"pl-8 border-0"})]})})}),(0,a.jsxs)("div",{className:"flex w-full items-center gap-2 p-3 border-t justify-between",children:[a.jsx(c.I,{autoFocus:!0,value:d,onChange:e=>g(e.target.value),onKeyDown:e=>{"Enter"===e.key&&U()},placeholder:"Name",className:"flex-1"}),a.jsx(o.z,{variant:"secondary",tabIndex:1,disabled:W.loading||!d.trim(),onClick:async()=>{U()},children:a.jsx("div",{className:"font-semibold",children:a.jsx(b.Z,{})})})]}),B.loading&&(0,a.jsxs)("div",{className:"w-full flex flex-col p-2 pt-0 pb-2",children:[a.jsx(p.O,{className:"w-full rounded h-[70px] rounded-md"}),a.jsx(p.O,{className:"w-full rounded h-[70px] rounded-md mt-3"}),a.jsx(p.O,{className:"w-full rounded h-[70px] rounded-md mt-3"}),a.jsx(p.O,{className:"w-full rounded h-[70px] rounded-md mt-3"})]}),!B.loading&&!B?.data?.agent_sessionsPagination?.items?.length&&a.jsx("div",{className:"w-full flex",children:a.jsx("p",{className:"mx-auto mt-5",children:"No sessions found."})}),B.loading?null:B?.data?.agent_sessionsPagination?.items?.map(s=>{let n=_.I({...s,agent:s.agent.id},i);return a.jsx("div",{className:"w-full px-2 flex flex-col items-start gap-0 rounded-none border-none text-left text-sm mb-2",children:a.jsx(l.default,{href:`/chat/${e}/${s.id}`,className:C.cn("p-2 w-full flex flex-col items-start gap-2 rounded-md p-3 text-left text-sm transition-all hover:bg-accent",t.includes(s.id)&&"bg-muted",n?"border border-l-4 border-r-0 border-y-0 border-gray-700":"border border-l-4 border-r-0 border-y-0 border-yellow-900"),children:a.jsxs("div",{className:"flex w-full flex-col px-2",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("div",{className:"text-md font-medium max-w-[80%] truncate",children:s.title?s.title?.substring(0,20):"No title"}),a.jsxs("div",{className:C.cn("ml-0 text-xs capitalize",t.includes(s.id)?"text-foreground":"text-muted-foreground"),children:[s.updatedAt?w.Q(new Date(s.updatedAt),{addSuffix:!0}):null,"."]})]}),n&&a.jsxs(y.h_,{children:[a.jsx(y.$F,{asChild:!0,children:a.jsxs(o.z,{variant:"ghost",className:"flex size-8 p-0 data-[state=open]:bg-muted",children:[a.jsx(N.nWS,{className:"size-4"}),a.jsx("span",{className:"sr-only",children:"Open menu"})]})}),a.jsxs(y.AW,{align:"end",className:"w-[160px]",children:[a.jsx(y.Xi,{className:"cursor-pointer",onClick:e=>{e.preventDefault(),e.stopPropagation(),I(s.id),A(s.title||""),D(!0)},children:"Rename"}),a.jsx(y.Xi,{className:"cursor-pointer",onClick:()=>{R({variables:{id:s.id}}),r({title:"Deleting session",description:"We deleted the session."})},children:"Delete"})]})]})]}),a.jsx("small",{className:"text-xs text-muted-foreground",children:s.agent?.name})]})},s.id)},s.id)}),a.jsx(k.Vq,{open:F,onOpenChange:D,children:(0,a.jsxs)(k.cZ,{children:[(0,a.jsxs)(k.fK,{children:[a.jsx(k.$N,{children:"Rename Session"}),a.jsx(k.Be,{children:"Enter a new name for this session."})]}),a.jsx(c.I,{value:Z,onChange:e=>A(e.target.value),onKeyDown:e=>{"Enter"===e.key&&J()},placeholder:"Session name"}),(0,a.jsxs)(k.cN,{children:[a.jsx(o.z,{variant:"outline",onClick:()=>{D(!1),I(null),A("")},children:"Cancel"}),a.jsx(o.z,{onClick:J,disabled:K.loading||!Z.trim(),children:"Rename"})]})]})})]},e+s)}function O(){let[e,s]=m.useState(""),[t,N]=m.useState(null),[w,b]=m.useState(!1),[y,k]=m.useState(!1),[S,C]=m.useState(!1),z=(0,f.useParams)(),_=(0,f.usePathname)(),{user:O}=(0,m.useContext)(v.S),[F,D]=(0,m.useState)(O),$=(0,x.aM)(u.W9,{fetchPolicy:"no-cache",nextFetchPolicy:"network-only",variables:{ids:F?.favourite_agents||[]},skip:!F?.favourite_agents?.length}),I=(0,x.aM)(u.ym,{fetchPolicy:"no-cache",nextFetchPolicy:"network-only",variables:{page:1,limit:200,filters:{...F?.super_admin?{}:{active:!0},...e?{name:{contains:e}}:{}}}}),[Z]=(0,h.D)(u.Pe,{onCompleted:e=>{D({...F,favourite_agents:e.usersUpdateOneById?.item?.favourite_agents})}}),A=(e,s)=>{s.preventDefault(),s.stopPropagation(),N(e),b(!0)},B=(e,s)=>{let t;s.preventDefault(),s.stopPropagation(),console.log("user",F);let a=F?.favourite_agents||[];console.log("newFavourites",t=a.includes(e)?a.filter(s=>s!==e):[...a,e]),Z({variables:{id:F.id,favourite_agents:t}})},R=z.agent?I?.data?.agentsPagination?.items?.find(e=>e.id===z.agent):null,G=e=>e.image?a.jsx("img",{src:e.image,alt:`${e.name} profile`,className:"h-4 w-4 rounded-full object-cover"}):a.jsx("div",{className:"h-4 w-4 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-xs font-medium",children:e.name?.charAt(0).toUpperCase()||"A"});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"pb-12 w-[250px]",children:[a.jsx("div",{className:"space-y-4 py-4",children:(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"mb-2 px-4 text-lg font-semibold tracking-tight",children:"Agents"}),a.jsx("div",{children:(0,a.jsxs)("div",{className:"relative",children:[a.jsx(n.Z,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),a.jsx(c.I,{placeholder:"Search agents...",value:e,onChange:e=>s(e.target.value),className:"pl-8 h-9 border-0"})]})}),(0,a.jsxs)("div",{className:"space-y-1 border-t px-2 pt-2",children:[R&&!S&&(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx(o.z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 flex-shrink-0",onClick:()=>C(!S),children:a.jsx(r.Z,{className:"h-3 w-3"})}),a.jsx(l.default,{onClick:()=>C(!1),href:`/chat/${R.id}`,className:"flex-1",children:(0,a.jsxs)(o.z,{onClick:()=>C(!1),variant:_.includes(R.id)?"secondary":"ghost",className:"w-full justify-start gap-2 pr-5",children:[G(R),a.jsx("span",{className:"flex-1 text-left",children:a.jsx(g.L,{text:R.name,length:7})})]})}),a.jsx(o.z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 flex-shrink-0",onClick:e=>B(R.id,e),children:a.jsx(i.Z,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"})}),a.jsx(o.z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 flex-shrink-0",onClick:e=>A(R.id,e),children:a.jsx(d.Z,{className:"h-3 w-3"})})]},`fav-${R.id}`),(!R||S||e)&&(0,a.jsxs)(a.Fragment,{children:[F?.favourite_agents&&F?.favourite_agents?.length>0&&!e&&(0,a.jsxs)(a.Fragment,{children:[$.loading&&(0,a.jsxs)(a.Fragment,{children:[a.jsx(p.O,{className:"w-[100%] h-[32px] rounded-lg"}),a.jsx(p.O,{className:"w-[100%] h-[32px] rounded-lg"})]}),!$.loading&&(()=>{let e=$?.data?.agentByIds||[],s=y?e:e.slice(0,4);return(0,a.jsxs)(a.Fragment,{children:[s.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx(l.default,{href:`/chat/${e.id}`,className:"flex-1",children:(0,a.jsxs)(o.z,{variant:_.includes(e.id)?"secondary":"ghost",className:"w-full justify-start gap-2 pr-1",children:[G(e),a.jsx("span",{className:"flex-1 text-left",children:a.jsx(g.L,{text:e.name,length:10})})]})}),a.jsx(o.z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 flex-shrink-0",onClick:s=>B(e.id,s),children:a.jsx(i.Z,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"})}),a.jsx(o.z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 flex-shrink-0",onClick:s=>A(e.id,s),children:a.jsx(d.Z,{className:"h-3 w-3"})})]},`fav-${e.id}`)),e.length>4&&a.jsx(o.z,{variant:"ghost",className:"w-full justify-center text-xs text-muted-foreground h-8",onClick:()=>k(!y),children:y?"Show less":`Show more (${e.length-4})`})]})})()]}),I.loading&&(0,a.jsxs)(a.Fragment,{children:[a.jsx(p.O,{className:"w-[100%] h-[32px] rounded-lg"}),a.jsx(p.O,{className:"w-[100%] h-[32px] rounded-lg"}),a.jsx(p.O,{className:"w-[100%] h-[32px] rounded-lg"}),a.jsx(p.O,{className:"w-[100%] h-[32px] rounded-lg"}),a.jsx(p.O,{className:"w-[100%] h-[32px] rounded-lg"})]}),!I.loading&&(()=>{let s=I?.data?.agentsPagination?.items?.filter(s=>!F?.favourite_agents?.includes(s.id)||e)||[],t=e||S?s:s.slice(0,4);return(0,a.jsxs)(a.Fragment,{children:[t.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[a.jsx(l.default,{href:`/chat/${e.id}`,className:"flex-1",children:(0,a.jsxs)(o.z,{variant:_.includes(e.id)?"secondary":"ghost",className:"w-full justify-start gap-2 pr-1",children:[G(e),a.jsx("span",{className:"flex-1 text-left",children:a.jsx(g.L,{text:e.name,length:14})})]})}),a.jsx(o.z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 flex-shrink-0",onClick:s=>B(e.id,s),children:a.jsx(i.Z,{className:`h-3 w-3 ${F?.favourite_agents?.includes(e.id)?"fill-yellow-400 text-yellow-400":""}`})}),a.jsx(o.z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 flex-shrink-0",onClick:s=>A(e.id,s),children:a.jsx(d.Z,{className:"h-3 w-3"})})]},e.id)),!e&&s.length>4&&a.jsx(o.z,{variant:"ghost",className:"w-full justify-center text-xs text-muted-foreground h-8",onClick:()=>C(!S),children:S?"Show less":`Show more (${s.length-4})`})]})})()]})]})]})}),z.agent&&a.jsx(P,{agent:z.agent,type:"chat"})]}),t&&a.jsx(j.z,{agentId:t,open:w,onOpenChange:e=>{b(e),e||N(null)}})]})}function F({children:e}){return(0,a.jsxs)("div",{className:"flex h-full",children:[a.jsx("div",{className:"border-r bg-muted/10",children:a.jsx(O,{})}),e]})}},29718:(e,s,t)=>{"use strict";t.d(s,{L:()=>l});var a=t(10326);function l({text:e,length:s}){return e.length>s?(0,a.jsxs)(a.Fragment,{children:[e.slice(0,s),"..."]}):a.jsx(a.Fragment,{children:e})}},43641:(e,s,t)=>{"use strict";t.d(s,{I:()=>a});let a=(e,s)=>{let t="private"===e.rights_mode,a="public"===e.rights_mode,l="users"===e.rights_mode,n="roles"===e.rights_mode,r=s.super_admin,i=e.created_by===s.id.toString(),d=!1;return t&&i&&(d=!0),a&&(d=!0),l&&(d=e.RBAC?.users?.find(e=>e.id===s.id)?.rights==="write"),n&&(d=e.RBAC?.roles?.find(e=>e.id===s.role?.id)?.rights==="write"),r&&(d=!0),d}},33734:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});let a=(0,t(76557).Z)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]])},90502:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(68570).createProxy)(String.raw`/Users/daniel.claessen/Desktop/Projects/exulu/frontend/app/(application)/chat/layout.tsx#default`)}};