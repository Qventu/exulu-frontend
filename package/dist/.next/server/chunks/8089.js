"use strict";exports.id=8089,exports.ids=[8089],exports.modules={360:(e,s,a)=>{a.d(s,{x:()=>y});var t=a(10326),r=a(17577),l=a(18753),i=a(15211),n=a(42270),d=a(62288),o=a(90772),c=a(54432),m=a(87673),x=a(31048),h=a(941),u=a(85206),p=a(98091),v=a(34789),g=a(77863),b=a(15286),f=a(79210),j=a(36931);function y({isOpen:e,onClose:s,messages:a,sessionTitle:y,existingWorkflow:w,isReadOnly:N=!1}){let{user:k}=(0,r.useContext)(i.S),{toast:C}=(0,v.pm)(),[Z,_]=(0,r.useState)({rights_mode:w?.rights_mode||"private",users:w?.RBAC?.users||[],roles:w?.RBAC?.roles||[],projects:w?.RBAC?.projects||[]}),A=!!w,[z,S]=(0,r.useState)(w?.name||""),[D,U]=(0,r.useState)(w?.description||""),[E,R]=(0,r.useState)(w?.variables||[]),[V,B]=(0,r.useState)(w?.steps_json||[]),[W,$]=(0,r.useState)(!1),[M,P]=(0,r.useState)("setup"),[q,F]=(0,r.useState)(!1),[I,L]=(0,r.useState)(null),[O,H]=(0,r.useState)(""),[K]=(0,l.D)(n.B_),[T]=(0,l.D)(n._J),G=(0,r.useCallback)((e,s)=>{if(!e.match(/^[A-Za-z_][A-Za-z0-9_]{1,63}$/))return C({title:"Invalid variable name",description:"Variable name must start with a letter or underscore, contain only letters, numbers, and underscores, and be 2-64 characters long.",variant:"destructive"}),!1;if(E.some(s=>s.name===e))return!0;let a={name:e,type:"string",required:!0,description:s||"Auto-detected variable"};return R(e=>[...e,a]),!0},[E,C]),J=(0,r.useCallback)((e,s)=>{let a=(s.match(/\{([A-Za-z_][A-Za-z0-9_]{1,63})\}/g)||[]).map(e=>e.slice(1,-1));a.forEach(e=>{G(e)}),B(t=>t.map(t=>t.id===e?{...t,content:s,variablesUsed:a}:t));let t=new Set;V.forEach(a=>{a.id===e?(s.match(/\{([A-Za-z_][A-Za-z0-9_]{1,63})\}/g)||[]).forEach(e=>t.add(e.slice(1,-1))):a.variablesUsed&&a.variablesUsed.forEach(e=>t.add(e))}),R(e=>e.filter(e=>t.has(e.name)))},[V,G]),Q=(0,r.useCallback)(e=>{R(s=>s.filter(s=>s.name!==e)),B(s=>s.map(s=>({...s,content:s.content?.replace(RegExp(`\\{${e}\\}`,"g"),""),variablesUsed:s.variablesUsed?.filter(s=>s!==e)||[]})))},[]),X=(0,r.useCallback)((e,s)=>s.match(/^[A-Za-z_][A-Za-z0-9_]{1,63}$/)?E.some(a=>a.name===s&&a.name!==e)?(C({title:"Variable name already exists",description:"A variable with this name already exists.",variant:"destructive"}),!1):(R(a=>a.map(a=>a.name===e?{...a,name:s}:a)),B(a=>a.map(a=>({...a,content:a.content?.replace(RegExp(`\\{${e}\\}`,"g"),`{${s}}`),variablesUsed:a.variablesUsed?.map(a=>a===e?s:a)||[]}))),!0):(C({title:"Invalid variable name",description:"Variable name must start with a letter or underscore and contain only letters, numbers, and underscores.",variant:"destructive"}),!1),[E,C]),Y=(0,r.useMemo)(()=>!!z.trim()&&0!==V.length&&("users"!==Z.rights_mode||Z.users?.length!==0)&&("roles"!==Z.rights_mode||Z.roles?.length!==0)&&("projects"!==Z.rights_mode||Z.projects?.length!==0)&&V.filter(e=>"user"===e.type).every(e=>(e.content||"").replace(/\{[^}]+\}/g,"").trim().length>0),[z,V,Z]),ee=(0,r.useCallback)(async()=>{if(Y&&k?.id){$(!0);try{let e=V.map(e=>({id:e.id,type:e.type,..."user"===e.type&&{content:e.content},..."assistant"===e.type&&{contentExample:e.contentExample},..."tool"===e.type&&{toolName:e.toolName}}));A&&w?(await T({variables:{id:w.id,name:z.trim(),description:D.trim()||null,rights_mode:Z.rights_mode,RBAC:{users:Z.users,roles:Z.roles,projects:Z.projects},variables:E,steps_json:e}}),C({title:"Workflow updated!",description:`"${z}" has been updated successfully.`})):(await K({variables:{name:z.trim(),description:D.trim()||null,owner:k.id,rights_mode:Z.rights_mode,RBAC:{users:Z.users,roles:Z.roles,projects:Z.projects},variables:E,steps_json:e}}),C({title:"Workflow created!",description:`"${z}" has been saved as a workflow template.`})),s()}catch(e){console.error("Error saving workflow:",e),C({title:"Error saving workflow",description:"There was an error saving your workflow. Please try again.",variant:"destructive"})}finally{$(!1)}}},[Y,k?.id,z,D,Z,E,V,K,T,C,s,A,w]);return e?t.jsx(d.Vq,{open:e,onOpenChange:s,children:(0,t.jsxs)(d.cZ,{className:"max-w-4xl max-h-[92vh] flex flex-col",children:[(0,t.jsxs)(d.fK,{className:"pb-4",children:[t.jsx(d.$N,{className:"text-lg",children:A?N?"View Workflow":"Edit Workflow":"Save as Workflow"}),t.jsx(d.Be,{className:"text-sm",children:A?N?"View workflow details and configuration.":"Modify this workflow template. Edit your messages and use {variable_name} syntax to create variables.":"Convert this conversation into a reusable workflow template. Edit your messages and use {variable_name} syntax to create variables."})]}),t.jsx("div",{className:"flex-1 mt-6",children:(0,t.jsxs)(f.mQ,{value:M,onValueChange:P,className:"h-full flex flex-col",children:[(0,t.jsxs)(f.dr,{className:"grid w-full grid-cols-2 mb-6",children:[t.jsx(f.SP,{value:"setup",className:"data-[state=active]:bg-background",children:"Setup & Permissions"}),t.jsx(f.SP,{value:"workflow",className:"data-[state=active]:bg-background",children:"Workflow Steps & Variables"})]}),(0,t.jsxs)("div",{className:"flex-1 pb-6",children:[t.jsx(f.nU,{value:"setup",className:"mt-0 h-full",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[t.jsx(x._,{htmlFor:"workflow-name",className:"text-base font-semibold",children:"Workflow Name *"}),t.jsx(c.I,{id:"workflow-name",value:z,onChange:e=>S(e.target.value),placeholder:"My Workflow",className:"mt-2 h-11",readOnly:N}),!z.trim()&&(0,t.jsxs)("p",{className:"text-sm text-destructive mt-1 flex items-center",children:[t.jsx("span",{className:"mr-1",children:"âš ï¸"}),"Workflow name is required"]})]}),(0,t.jsxs)("div",{children:[t.jsx(x._,{htmlFor:"workflow-description",className:"text-base font-semibold",children:"Description"}),t.jsx(m.g,{id:"workflow-description",value:D,onChange:e=>U(e.target.value),placeholder:"Describe what this workflow does and when to use it...",rows:3,className:"mt-2 resize-none",readOnly:N})]})]}),(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{children:[t.jsx("h3",{className:"text-base font-semibold mb-1",children:"Sharing & Permissions"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Control who can view and edit this workflow"})]}),(0,t.jsxs)(o.z,{type:"button",variant:"outline",size:"sm",onClick:()=>F(!q),className:"ml-4",children:[q?"Hide Advanced":"Show Advanced",t.jsx(h.Z,{className:(0,g.cn)("w-4 h-4 ml-1 transition-transform",q&&"rotate-180")})]})]}),q&&t.jsx(b.P,{initialRightsMode:w?.rights_mode,initialUsers:w?.RBAC?.users,initialRoles:w?.RBAC?.roles,initialProjects:w?.RBAC?.projects,onChange:(e,s,a,t)=>{_({rights_mode:e,users:s,roles:a,projects:t})}}),!q&&t.jsx("div",{className:"text-sm text-muted-foreground bg-muted/30 p-3 rounded-md",children:"Using default permissions (private to you)"})]})]})}),t.jsx(f.nU,{value:"workflow",className:"mt-0 h-full",children:(0,t.jsxs)("div",{className:"h-full flex gap-6",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"mb-4",children:[t.jsx("h3",{className:"text-base font-semibold mb-2",children:"Conversation Steps"}),t.jsx("div",{className:"border rounded-lg p-3 mb-4",children:(0,t.jsxs)("p",{className:"text-sm",children:["\uD83D\uDCA1 ",t.jsx("strong",{children:"Pro tip:"})," Use ","{variable_name}"," syntax in your messages to create reusable variables. For example you can use ","{company_name}"," to create a variable for the company name so you can reuse this flow template with different companies."]})})]}),t.jsx("div",{className:"space-y-4 max-h-[500px] overflow-y-auto pr-2",children:V.map((e,s)=>(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"border rounded-lg p-4 bg-card",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("span",{className:(0,g.cn)("text-sm font-medium px-3 py-1 rounded-full","user"===e.type?"bg-blue-100 text-blue-700":"assistant"===e.type?"bg-green-100 text-green-700":"bg-purple-100 text-purple-700"),children:"user"===e.type?"\uD83D\uDC64 User":"assistant"===e.type?"\uD83E\uDD16 Assistant":`ðŸ”§ ${e.toolName}`}),e.variablesUsed&&e.variablesUsed.length>0&&t.jsx("div",{className:"flex gap-1 flex-wrap",children:e.variablesUsed.map(e=>t.jsx("span",{className:"text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded font-mono border border-blue-200",children:`{${e}}`},e))})]}),"user"===e.type?t.jsx("div",{children:t.jsx(m.g,{value:e.content||"",onChange:s=>J(e.id,s.target.value),placeholder:"Enter your message...",className:"min-h-[80px] resize-none",rows:3,readOnly:N})}):t.jsx("div",{className:"bg-muted/50 p-3 rounded-md",children:"assistant"===e.type?(0,t.jsxs)("div",{children:[t.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Example response (will be regenerated):"}),t.jsx(j.H,{children:e.contentExample})]}):(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:["Tool: ",e.toolName]}),t.jsx("div",{className:"text-sm text-muted-foreground",children:"Parameters will be generated dynamically"})]})})]}),s<V.length-1&&t.jsx("div",{className:"flex justify-center my-3",children:t.jsx(h.Z,{className:"w-5 h-5 text-muted-foreground/50"})})]},e.id))})]}),(0,t.jsxs)("div",{className:"w-80",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("h3",{className:"text-base font-semibold mb-2",children:["Variables (",E.length,")"]}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Auto-detected from your messages"})]}),E.length>0?t.jsx("div",{className:"space-y-3 max-h-[500px] overflow-y-auto",children:E.map(e=>(0,t.jsxs)("div",{className:"border rounded-lg p-3 bg-card",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[t.jsx("div",{className:"font-mono text-blue-600 font-medium text-sm",children:`{${e.name}}`}),!N&&t.jsx("div",{className:"flex gap-1",children:I===e.name?t.jsx(c.I,{value:O,onChange:e=>H(e.target.value),className:"h-6 text-xs font-mono w-20",placeholder:"variable_name",autoFocus:!0,onKeyDown:s=>{"Enter"===s.key?(O&&O!==e.name&&X(e.name,O),L(null),H("")):"Escape"===s.key&&(L(null),H(""))},onBlur:()=>{O&&O!==e.name&&X(e.name,O),L(null),H("")}}):(0,t.jsxs)(t.Fragment,{children:[t.jsx(o.z,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>{L(e.name),H(e.name)},children:t.jsx(u.Z,{className:"w-3 h-3"})}),t.jsx(o.z,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-destructive hover:bg-destructive/10",onClick:()=>Q(e.name),children:t.jsx(p.Z,{className:"w-3 h-3"})})]})})]}),t.jsx("div",{className:"text-xs text-muted-foreground mb-2",children:e.description}),(0,t.jsxs)("div",{className:"flex gap-1",children:[t.jsx("span",{className:"text-xs bg-gray-100 text-gray-700 px-1.5 py-0.5 rounded",children:e.type}),e.required&&t.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-1.5 py-0.5 rounded",children:"required"})]})]},e.name))}):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground border-2 border-dashed rounded-lg",children:[t.jsx("div",{className:"mb-3",children:t.jsx("span",{className:"text-3xl",children:"\uD83D\uDCDD"})}),t.jsx("div",{className:"text-sm mb-1 font-medium",children:"No variables yet"}),(0,t.jsxs)("div",{className:"text-xs",children:["Use ","{variable_name}"," syntax in your messages"]})]})]})]})})]})]})}),t.jsx("div",{className:"border-t p-4 bg-background",children:(0,t.jsxs)(d.cN,{children:[t.jsx(o.z,{variant:"outline",onClick:s,children:N?"Close":"Cancel"}),!N&&t.jsx(t.Fragment,{children:t.jsx(o.z,{onClick:ee,disabled:!Y||W,className:(0,g.cn)("min-w-[140px]",!Y&&"opacity-50 cursor-not-allowed"),children:W?(0,t.jsxs)(t.Fragment,{children:[t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),A?"Updating...":"Saving..."]}):A?"Update Workflow":"Save Workflow"})})]})})]})}):null}},54659:(e,s,a)=>{a.d(s,{Z:()=>t});let t=(0,a(76557).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},47206:(e,s,a)=>{a.d(s,{Z:()=>t});let t=(0,a(76557).Z)("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]])},48998:(e,s,a)=>{a.d(s,{Z:()=>t});let t=(0,a(76557).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},65983:(e,s,a)=>{a.d(s,{Z:()=>t});let t=(0,a(76557).Z)("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]])},54014:(e,s,a)=>{a.d(s,{Z:()=>t});let t=(0,a(76557).Z)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])},9015:(e,s,a)=>{a.d(s,{Z:()=>t});let t=(0,a(76557).Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},85206:(e,s,a)=>{a.d(s,{Z:()=>t});let t=(0,a(76557).Z)("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]])},91470:(e,s,a)=>{a.d(s,{Z:()=>t});let t=(0,a(76557).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])}};