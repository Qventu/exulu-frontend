"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7699],{27699:function(e,s,a){a.d(s,{x:function(){return w}});var t=a(57437),l=a(2265),r=a(12199),n=a(13832),i=a(27689),o=a(26110),d=a(62869),c=a(95186),m=a(76818),u=a(26815),x=a(40875),h=a(88893),v=a(18930),p=a(77992),b=a(94508),f=a(8014),g=a(12339),j=a(35629);function w(e){var s,a,w,N,y,k;let{isOpen:_,onClose:C,messages:E,sessionTitle:A,existingWorkflow:D,isReadOnly:S=!1}=e,{user:U}=(0,l.useContext)(n.S),{toast:z}=(0,p.pm)(),[Z,R]=(0,l.useState)({rights_mode:(null==D?void 0:D.rights_mode)||"private",users:(null==D?void 0:null===(s=D.RBAC)||void 0===s?void 0:s.users)||[],roles:(null==D?void 0:null===(a=D.RBAC)||void 0===a?void 0:a.roles)||[],projects:(null==D?void 0:null===(w=D.RBAC)||void 0===w?void 0:w.projects)||[]}),W=!!D,[B,P]=(0,l.useState)((null==D?void 0:D.name)||""),[V,F]=(0,l.useState)((null==D?void 0:D.description)||""),[I,q]=(0,l.useState)((null==D?void 0:D.variables)||[]),[M,O]=(0,l.useState)((null==D?void 0:D.steps_json)||[]),[$,H]=(0,l.useState)(!1),[K,T]=(0,l.useState)("setup"),[J,Q]=(0,l.useState)(!1),[G,L]=(0,l.useState)(null),[X,Y]=(0,l.useState)(""),[ee]=(0,r.D)(i.B_),[es]=(0,r.D)(i._J);l.useEffect(()=>{if(E.length>0){let e=[];E.forEach((s,a)=>{let t=s.content||(s.parts?s.parts.filter(e=>"text"===e.type).map(e=>e.text).join("\n"):"");"user"===s.role?e.push({id:"step_".concat(a+1),type:"user",content:t,variablesUsed:[]}):"assistant"===s.role?e.push({id:"step_".concat(a+1),type:"assistant",contentExample:t}):"system"===s.role&&s.parts&&s.parts.forEach((s,t)=>{"tool-invocation"===s.type&&s.toolInvocation&&e.push({id:"step_".concat(a+1,"_").concat(t),type:"tool",toolName:s.toolInvocation.toolName})})}),console.log("transformedSteps",e),O(e),P(A||"My Workflow")}},[E,A,M.length]);let ea=(0,l.useCallback)((e,s)=>{if(!e.match(/^[A-Za-z_][A-Za-z0-9_]{1,63}$/))return z({title:"Invalid variable name",description:"Variable name must start with a letter or underscore, contain only letters, numbers, and underscores, and be 2-64 characters long.",variant:"destructive"}),!1;if(I.some(s=>s.name===e))return!0;let a={name:e,type:"string",required:!0,description:s||"Auto-detected variable"};return q(e=>[...e,a]),!0},[I,z]),et=(0,l.useCallback)((e,s)=>{let a=(s.match(/\{([A-Za-z_][A-Za-z0-9_]{1,63})\}/g)||[]).map(e=>e.slice(1,-1));a.forEach(e=>{ea(e)}),O(t=>t.map(t=>t.id===e?{...t,content:s,variablesUsed:a}:t));let t=new Set;M.forEach(a=>{a.id===e?(s.match(/\{([A-Za-z_][A-Za-z0-9_]{1,63})\}/g)||[]).forEach(e=>t.add(e.slice(1,-1))):a.variablesUsed&&a.variablesUsed.forEach(e=>t.add(e))}),q(e=>e.filter(e=>t.has(e.name)))},[M,ea]),el=(0,l.useCallback)(e=>{q(s=>s.filter(s=>s.name!==e)),O(s=>s.map(s=>{var a,t;return{...s,content:null===(a=s.content)||void 0===a?void 0:a.replace(RegExp("\\{".concat(e,"\\}"),"g"),""),variablesUsed:(null===(t=s.variablesUsed)||void 0===t?void 0:t.filter(s=>s!==e))||[]}}))},[]),er=(0,l.useCallback)((e,s)=>s.match(/^[A-Za-z_][A-Za-z0-9_]{1,63}$/)?I.some(a=>a.name===s&&a.name!==e)?(z({title:"Variable name already exists",description:"A variable with this name already exists.",variant:"destructive"}),!1):(q(a=>a.map(a=>a.name===e?{...a,name:s}:a)),O(a=>a.map(a=>{var t,l;return{...a,content:null===(t=a.content)||void 0===t?void 0:t.replace(RegExp("\\{".concat(e,"\\}"),"g"),"{".concat(s,"}")),variablesUsed:(null===(l=a.variablesUsed)||void 0===l?void 0:l.map(a=>a===e?s:a))||[]}})),!0):(z({title:"Invalid variable name",description:"Variable name must start with a letter or underscore and contain only letters, numbers, and underscores.",variant:"destructive"}),!1),[I,z]),en=(0,l.useMemo)(()=>{var e,s,a;return!!B.trim()&&0!==M.length&&("users"!==Z.rights_mode||(null===(e=Z.users)||void 0===e?void 0:e.length)!==0)&&("roles"!==Z.rights_mode||(null===(s=Z.roles)||void 0===s?void 0:s.length)!==0)&&("projects"!==Z.rights_mode||(null===(a=Z.projects)||void 0===a?void 0:a.length)!==0)&&M.filter(e=>"user"===e.type).every(e=>(e.content||"").replace(/\{[^}]+\}/g,"").trim().length>0)},[B,M,Z]),ei=(0,l.useCallback)(async()=>{if(en&&(null==U?void 0:U.id)){H(!0);try{let e=M.map(e=>({id:e.id,type:e.type,..."user"===e.type&&{content:e.content},..."assistant"===e.type&&{contentExample:e.contentExample},..."tool"===e.type&&{toolName:e.toolName}}));W&&D?(await es({variables:{id:D.id,name:B.trim(),description:V.trim()||null,rights_mode:Z.rights_mode,RBAC:{users:Z.users,roles:Z.roles,projects:Z.projects},variables:I,steps_json:e}}),z({title:"Workflow updated!",description:'"'.concat(B,'" has been updated successfully.')})):(await ee({variables:{name:B.trim(),description:V.trim()||null,owner:U.id,rights_mode:Z.rights_mode,RBAC:{users:Z.users,roles:Z.roles,projects:Z.projects},variables:I,steps_json:e}}),z({title:"Workflow created!",description:'"'.concat(B,'" has been saved as a workflow template.')})),C()}catch(e){console.error("Error saving workflow:",e),z({title:"Error saving workflow",description:"There was an error saving your workflow. Please try again.",variant:"destructive"})}finally{H(!1)}}},[en,null==U?void 0:U.id,B,V,Z,I,M,ee,es,z,C,W,D]);return _?(0,t.jsx)(o.Vq,{open:_,onOpenChange:C,children:(0,t.jsxs)(o.cZ,{className:"max-w-4xl max-h-[92vh] flex flex-col",children:[(0,t.jsxs)(o.fK,{className:"pb-4",children:[(0,t.jsx)(o.$N,{className:"text-lg",children:W?S?"View Workflow":"Edit Workflow":"Save as Workflow"}),(0,t.jsx)(o.Be,{className:"text-sm",children:W?S?"View workflow details and configuration.":"Modify this workflow template. Edit your messages and use {variable_name} syntax to create variables.":"Convert this conversation into a reusable workflow template. Edit your messages and use {variable_name} syntax to create variables."})]}),(0,t.jsx)("div",{className:"flex-1 mt-6",children:(0,t.jsxs)(g.mQ,{value:K,onValueChange:T,className:"h-full flex flex-col",children:[(0,t.jsxs)(g.dr,{className:"grid w-full grid-cols-2 mb-6",children:[(0,t.jsx)(g.SP,{value:"setup",className:"data-[state=active]:bg-background",children:"Setup & Permissions"}),(0,t.jsx)(g.SP,{value:"workflow",className:"data-[state=active]:bg-background",children:"Workflow Steps & Variables"})]}),(0,t.jsxs)("div",{className:"flex-1 pb-6",children:[(0,t.jsx)(g.nU,{value:"setup",className:"mt-0 h-full",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u._,{htmlFor:"workflow-name",className:"text-base font-semibold",children:"Workflow Name *"}),(0,t.jsx)(c.I,{id:"workflow-name",value:B,onChange:e=>P(e.target.value),placeholder:"My Workflow",className:"mt-2 h-11",readOnly:S}),!B.trim()&&(0,t.jsxs)("p",{className:"text-sm text-destructive mt-1 flex items-center",children:[(0,t.jsx)("span",{className:"mr-1",children:"⚠️"}),"Workflow name is required"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u._,{htmlFor:"workflow-description",className:"text-base font-semibold",children:"Description"}),(0,t.jsx)(m.g,{id:"workflow-description",value:V,onChange:e=>F(e.target.value),placeholder:"Describe what this workflow does and when to use it...",rows:3,className:"mt-2 resize-none",readOnly:S})]})]}),(0,t.jsxs)("div",{className:"border-t pt-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-base font-semibold mb-1",children:"Sharing & Permissions"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Control who can view and edit this workflow"})]}),(0,t.jsxs)(d.z,{type:"button",variant:"outline",size:"sm",onClick:()=>Q(!J),className:"ml-4",children:[J?"Hide Advanced":"Show Advanced",(0,t.jsx)(x.Z,{className:(0,b.cn)("w-4 h-4 ml-1 transition-transform",J&&"rotate-180")})]})]}),J&&(0,t.jsx)(f.P,{initialRightsMode:null==D?void 0:D.rights_mode,initialUsers:null==D?void 0:null===(N=D.RBAC)||void 0===N?void 0:N.users,initialRoles:null==D?void 0:null===(y=D.RBAC)||void 0===y?void 0:y.roles,initialProjects:null==D?void 0:null===(k=D.RBAC)||void 0===k?void 0:k.projects,onChange:(e,s,a,t)=>{R({rights_mode:e,users:s,roles:a,projects:t})}}),!J&&(0,t.jsx)("div",{className:"text-sm text-muted-foreground bg-muted/30 p-3 rounded-md",children:"Using default permissions (private to you)"})]})]})}),(0,t.jsx)(g.nU,{value:"workflow",className:"mt-0 h-full",children:(0,t.jsxs)("div",{className:"h-full flex gap-6",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-base font-semibold mb-2",children:"Conversation Steps"}),(0,t.jsx)("div",{className:"border rounded-lg p-3 mb-4",children:(0,t.jsxs)("p",{className:"text-sm",children:["\uD83D\uDCA1 ",(0,t.jsx)("strong",{children:"Pro tip:"})," Use ","{variable_name}"," syntax in your messages to create reusable variables. For example you can use ","{company_name}"," to create a variable for the company name so you can reuse this flow template with different companies."]})})]}),(0,t.jsx)("div",{className:"space-y-4 max-h-[500px] overflow-y-auto pr-2",children:M.map((e,s)=>(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"border rounded-lg p-4 bg-card",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,t.jsx)("span",{className:(0,b.cn)("text-sm font-medium px-3 py-1 rounded-full","user"===e.type?"bg-blue-100 text-blue-700":"assistant"===e.type?"bg-green-100 text-green-700":"bg-purple-100 text-purple-700"),children:"user"===e.type?"\uD83D\uDC64 User":"assistant"===e.type?"\uD83E\uDD16 Assistant":"\uD83D\uDD27 ".concat(e.toolName)}),e.variablesUsed&&e.variablesUsed.length>0&&(0,t.jsx)("div",{className:"flex gap-1 flex-wrap",children:e.variablesUsed.map(e=>(0,t.jsx)("span",{className:"text-xs bg-blue-50 text-blue-600 px-2 py-1 rounded font-mono border border-blue-200",children:"{".concat(e,"}")},e))})]}),"user"===e.type?(0,t.jsx)("div",{children:(0,t.jsx)(m.g,{value:e.content||"",onChange:s=>et(e.id,s.target.value),placeholder:"Enter your message...",className:"min-h-[80px] resize-none",rows:3,readOnly:S})}):(0,t.jsx)("div",{className:"bg-muted/50 p-3 rounded-md",children:"assistant"===e.type?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Example response (will be regenerated):"}),(0,t.jsx)(j.H,{children:e.contentExample})]}):(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:["Tool: ",e.toolName]}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Parameters will be generated dynamically"})]})})]}),s<M.length-1&&(0,t.jsx)("div",{className:"flex justify-center my-3",children:(0,t.jsx)(x.Z,{className:"w-5 h-5 text-muted-foreground/50"})})]},e.id))})]}),(0,t.jsxs)("div",{className:"w-80",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("h3",{className:"text-base font-semibold mb-2",children:["Variables (",I.length,")"]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Auto-detected from your messages"})]}),I.length>0?(0,t.jsx)("div",{className:"space-y-3 max-h-[500px] overflow-y-auto",children:I.map(e=>(0,t.jsxs)("div",{className:"border rounded-lg p-3 bg-card",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,t.jsx)("div",{className:"font-mono text-blue-600 font-medium text-sm",children:"{".concat(e.name,"}")}),!S&&(0,t.jsx)("div",{className:"flex gap-1",children:G===e.name?(0,t.jsx)(c.I,{value:X,onChange:e=>Y(e.target.value),className:"h-6 text-xs font-mono w-20",placeholder:"variable_name",autoFocus:!0,onKeyDown:s=>{"Enter"===s.key?(X&&X!==e.name&&er(e.name,X),L(null),Y("")):"Escape"===s.key&&(L(null),Y(""))},onBlur:()=>{X&&X!==e.name&&er(e.name,X),L(null),Y("")}}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.z,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>{L(e.name),Y(e.name)},children:(0,t.jsx)(h.Z,{className:"w-3 h-3"})}),(0,t.jsx)(d.z,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0 text-destructive hover:bg-destructive/10",onClick:()=>el(e.name),children:(0,t.jsx)(v.Z,{className:"w-3 h-3"})})]})})]}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground mb-2",children:e.description}),(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)("span",{className:"text-xs bg-gray-100 text-gray-700 px-1.5 py-0.5 rounded",children:e.type}),e.required&&(0,t.jsx)("span",{className:"text-xs bg-orange-100 text-orange-700 px-1.5 py-0.5 rounded",children:"required"})]})]},e.name))}):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground border-2 border-dashed rounded-lg",children:[(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCDD"})}),(0,t.jsx)("div",{className:"text-sm mb-1 font-medium",children:"No variables yet"}),(0,t.jsxs)("div",{className:"text-xs",children:["Use ","{variable_name}"," syntax in your messages"]})]})]})]})})]})]})}),(0,t.jsx)("div",{className:"border-t p-4 bg-background",children:(0,t.jsxs)(o.cN,{children:[(0,t.jsx)(d.z,{variant:"outline",onClick:C,children:S?"Close":"Cancel"}),!S&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(d.z,{onClick:ei,disabled:!en||$,className:(0,b.cn)("min-w-[140px]",!en&&"opacity-50 cursor-not-allowed"),children:$?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),W?"Updating...":"Saving..."]}):W?"Update Workflow":"Save Workflow"})})]})})]})}):null}}}]);
//# sourceMappingURL=7699-aa31177be6c66957.js.map